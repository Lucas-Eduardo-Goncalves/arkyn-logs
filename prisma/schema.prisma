generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String          @id
  email         String          @unique
  name          String
  utc           Int
  password      String
  createdAt     DateTime
  updatedAt     DateTime
  trafficSource TrafficSource[]
}

model TrafficSource {
  id            String        @id
  name          String
  trafficDomain String
  createdAt     DateTime
  updatedAt     DateTime
  userId        String
  user          User          @relation(fields: [userId], references: [id])
  domain        Domain[]
  pathname      Pathname[]
  httpTraffic   HttpTraffic[]
}

model Domain {
  id              String        @id
  value           String
  createdAt       DateTime
  trafficSourceId String
  trafficSource   TrafficSource @relation(fields: [trafficSourceId], references: [id])
  pathname        Pathname[]
  httpTraffic     HttpTraffic[]
}

model Pathname {
  id              String        @id
  value           String
  createdAt       DateTime
  trafficSourceId String
  domainId        String
  trafficSource   TrafficSource @relation(fields: [trafficSourceId], references: [id])
  domain          Domain        @relation(fields: [domainId], references: [id])
  httpTraffic     HttpTraffic[]
}

enum Method {
  POST
  PUT
  PATCH
  DELETE
  GET
}

enum Level {
  INFO
  FATAL
  WARNING
}

model HttpTraffic {
  id                  String        @id
  status              Int
  method              Method
  level               Level
  trafficUserId       String?
  createdAt           DateTime
  trafficSourceId     String
  domainId            String
  pathnameId          String
  domain              Domain        @relation(fields: [domainId], references: [id])
  trafficSource       TrafficSource @relation(fields: [trafficSourceId], references: [id])
  pathname            Pathname      @relation(fields: [pathnameId], references: [id])
  request             Request[]
  response            Response[]
}

model Request {
  id            String      @id
  headers       Json
  body          Json
  queryParams   Json
  createdAt     DateTime
  httpTrafficId String
  httpTraffic   HttpTraffic @relation(fields: [httpTrafficId], references: [id])
}

model Response {
  id            String      @id
  headers       Json
  body          Json
  createdAt     DateTime
  httpTrafficId String
  httpTraffic   HttpTraffic @relation(fields: [httpTrafficId], references: [id])
}
